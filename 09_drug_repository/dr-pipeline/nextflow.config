/*
================================================================
  Set default parameters
================================================================

Any parameters provided by the user with a -params-file or
with -- command-line arguments will override the values
defined below.
*/
params {
    // Global parameters
    help                  = false

    disease_map_circuits  = false
    disease_map_gene_list = false

    use_disgenet          = true
    disgenet              = false
    disgenet_disease_id   = false
    disgenet_threshold    = false

    drexml_target_genes   = false
    drexml_gene_expr_norm = false
    drexml_pathvals       = false
    drexml_results        = false

    gtex                  = false
    atc                   = false
    drugbank              = false
    
    output_folder = "${launchDir}/results/"
    n_gpus        = 0  // 0 for CPUs
    
    // Set the containers to use for each component
    container__python = "dlopezbioinfo/dr-pipeline:python-master-3016828"
    container__r      = "dlopezbioinfo/dr-pipeline:r-master-f7f998c"
    container__drexml = "dlopezbioinfo/dr-pipeline:drexml-master-1db6105"
}


/*
================================================================
  set profiles
================================================================
Set cpus/memory or create your own profile according
to your HPC
*/
profiles {
  singularity {
    singularity.autoMounts = true
    singularity.enabled = true
  }

  docker {
    docker.enabled = true
    docker.fixOwnership = true
  }

  slurm {
    process {
      executor = 'slurm'
      cpus = 1
      memory = '4 GB'
      time = '72h'
      beforeScript = 'ml singularity'

      withLabel: 'single_proc' {
        cpus = 1
        memory = 16.GB
      }

      withLabel: 'low_proc' {
        cpus = 2
        memory = 32.GB
      //  errorStrategy = 'ignore'
      }

      withLabel: 'high_mem' {
        cpus = 4
        memory = 370.GB
      }

      withLabel: 'med_proc' {
        cpus = 8
        memory = 64.GB
      }

      withLabel: 'high_proc' {
        cpus = 52
        memory = 370.GB
      }

    }
  }

  //TODO: add local profile

  debug { 
    process.beforeScript = 'echo $HOSTNAME' 
  }

  //TODO: add test profile
  /*test {
    params {
      input_folder = "${projectDir}/test/"  
    }
  }*/
}

manifest {
        name = 'dr-pipeline'
        author = 'Daniel López López; Miriam Palla; Kinza Rian; Carlos Loucera'
        homePage = 'https://github.com/babelomics/dr-pipeline'
        mainScript = 'main.nf'
        nextflowVersion = '>=23.10'
        version = '1.0.0'
}


// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']


dag {
  enabled = true
  file = "${params.output_folder}/report/pipeline_dag.svg"
  overwrite = true
}
report {
  enabled = true
  file = "${params.output_folder}/report/execution_report.html"
  overwrite = true
}
timeline {
  enabled = true
  file = "${params.output_folder}/report/execution_timeline.html"
  overwrite = true
}
trace {
  enabled = true
  file = "${params.output_folder}/report/execution_trace.txt"
  overwrite = true
}


nextflow.enable.moduleBinaries = true
